# TalkSheet

TalkSheet is a secure, production-ready, multi-agent system that allows enterprise employees to *talk to their spreadsheets* without ever exposing sensitive data to external LLM providers. Users load a spreadsheet and then query it conversationally from the terminal. TalkSheet executes fully local SQL-based reasoning and returns explanations generated by a controlled LLM path that never touches raw data.

This README is designed to satisfy the AI By The Bay Hackathon rubric, provide clear quickstart instructions, and give experienced engineers the depth needed to understand the system.

---
## 1. Overview / Elevator Pitch
TalkSheet lets enterprise users upload an `.xlsx` file and immediately chat with it using natural language. Users ask questions such as:
> “Show me the top‑performing regions last quarter and explain the trend.”

TalkSheet converts the question → SQL query → structured result → safe LLM explanation. **Raw spreadsheet data never leaves the system**, and only minimal aggregated SQL outputs are sent to the external LLM endpoint (gpt-5.1).

---
## 2. Problem Statement & Business Value
Large enterprises hold sensitive data in spreadsheets but cannot safely use cloud LLM tools to analyze them. Employees need:
- Fast, natural-language insights
- Zero risk of data exfiltration
- A workflow they already understand

**TalkSheet solves this** by enabling conversational analysis while guaranteeing that sensitive data never enters external LLM contexts.

---
## 3. Target Users
- Analysts who need quick insights
- Operations / Finance teams
- Managers who need summary explanations
- Security-conscious enterprises with strict data controls

---
## 4. Solution Summary
TalkSheet enables conversational querying of spreadsheets via an **AKKA‑powered multi-agent architecture**, using:
- A **File Ingestion Agent** (AKKA)
- A **Query Planning Agent** that generates SQL
- A **SQL Execution Agent** running on isolated, read‑only data
- An **LLM Explanation Agent** for natural‑language output
- **Redpanda** for event‑stream observability across all agent actions

---
## 5. Architecture
**Component Flow:**
1. **Upload**: User reference to `.xlsx` file (local path) → File Ingestion Agent
2. **Processing**: File is copied, normalized, and loaded into an in-memory SQL database
3. **Chat Input**: User message → Query Planning Agent
4. **Query Execution**: Generated SQL → SQL Execution Agent (read‑only)
5. **Explanation**: Result + original query → LLM Explanation Agent
6. **Observability**: Each step emits structured events to Redpanda

**Tech Stack:
- **Akka Agents, Streams, Memory, Orchestration** (all agents implemented natively)
- **Akka-based CLI** for terminal interaction
- **SQLite** (in-memory) for SQL execution
- **Redpanda** for event streaming, trace logging, and debugging** for event streaming, trace logging, and debugging

---
## 6. Threat Model & Security-by-Design
**Risks Addressed:**
- Prompt injection → Function-guarded SQL generation + allowlist SQL structure
- Data exfiltration → No raw rows returned to LLM; only aggregates
- Privilege escalation → SQL engine is read-only; no write/delete
- Broken access control → Local-only file ingestion; no remote data paths
- Sensitive data leakage → Spreadsheet never transmitted anywhere; in-memory SQL copy only

**Mitigations:**
- Strict SQL schema validation
- LLM output schema enforcing explanation-only responses
- Least-privilege access for all agents
- Redpanda audit trail with full Reason→Action→Result traces

---
## 7. Knowledge Layer
TalkSheet uses:
- Structured SQL data as the authoritative knowledge base
- Agent memory (Akka) for session context and query chaining
- Evidence-linked reasoning: SQL outputs → referenced in final explanations

---
## 8. Observability & Operability
**Every step emits an event to Redpanda:**
- User message received
- SQL query generated
- Query executed
- LLM explanation produced

Metrics include latency, success/error counts, SQL generation confidence, and safety-triggered fallbacks.

A lightweight runbook is included below.

---
## 9. Setup Instructions (One-Command Quickstart)
### **Prerequisites**
- JVM 17+ (all agents and runtime built on Akka)
- Docker (for Redpanda)
- `pip` or `npm` depending on SDK

### **1. Clone repo**
```bash
git clone <REPO_URL>
cd talksheet
```

### **2. Start Redpanda (local)**
```bash
docker compose up -d redpanda
```

### **3. Install dependencies**
```bash
make install
```

### **4. Run the app**
```bash
make run FILE=/path/to/your.xlsx
```
This starts the Akka-powered JVM CLI chat session.

---
## 10. Configuration (.env.sample)
```
LLM_PROVIDER=external-secure-endpoint
LLM_MODEL=gpt-5.1
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_ORG=
OBSERVABILITY_BROKER=localhost:9092
SQLITE_MEMORY_MODE=1
```

---
## 11. Seed/Test Data
Located in `fixtures/`. Includes example spreadsheets for deterministic regression tests.

---
## 12. Usage Guide
Once the server is running you can test the end-to-end pipeline:

1. **Upload a workbook**
   ```bash
   curl -F "file=@data/sample.xlsx" http://localhost:8080/api/upload-xlsx
   ```
   The response contains the `uploadId` registered in the SQLite catalog.

2. **Ask a question about that upload**
   ```bash
   curl -X POST http://localhost:8080/api/chat \
        -H "Content-Type: application/json" \
        -d '{"uploadId":"<UUID_FROM_UPLOAD>","question":"Show me the first rows"}'
   ```
   The system calls the query planner + SQL executor agents and returns the tabular rows that will later feed the explanation agent.

---
## 13. Tests & Evaluations
TalkSheet includes:
- SQL generation unit tests
- Agent-level integration tests
- Adversarial prompt-injection tests
- Deterministic fixtures for LLM evaluation

Run tests:
```bash
sbt test
```

To manually validate the conversational query path without the LLM, run the curl commands listed in the usage guide: they trigger the Upload → Planner → SQL Execution → HTTP response pipeline and log each step to the console.

---
## 14. Failure Path Behavior
The demo includes one forced failure path:
- Invalid SQL generation → blocked + safe fallback explanation

---
## 15. Runbook / Day-2 Operations
- **Reproduce issues**: re-run with `DEBUG=1` to enable full traces
- **Trace analysis**: consume Redpanda stream with included inspector tool
- **Rollback**: revert to prior agent prompt/policy versions

---
## 16. Roadmap: Path to Production
- Swap in “bring-your-own-LM” security-hardened model
- Add enterprise SSO integration
- Add fine-grained access controls

---
## 17. Post-Mortem Notes
*(To be completed during hackathon)*

---
## 18. Built With
- Akka Agents + Orchestration + Memory
- Redpanda
- SQLite
- JVM-based CLI (Akka-powered)
- External secure LLM endpoint (gpt-5.1)

---
## 19. License
MIT

